<!doctype html>
<html>
<head>
<meta charset="utf-8">
<style>
h1,
h2,
h3,
h4,
h5,
h6,
p,
blockquote {
margin: 0;
padding: 0;
}
body {
font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", Arial, sans-serif;
font-size: 14px;
line-height: 21px;
color: #666;
margin: 10px 13px 10px 13px;
}
::selection {
background: rgba(0,0,0,.7);
color: #fff;
}
::-moz-selection {
background: rgba(0,0,0,.7);
color: #fff;
}
a {
color: #0069d6;
}
a:hover {
color: #0050a3;
text-decoration: none;
}
a img {
border: none;
}
p {
margin-bottom: 9px;
}
h1,
h2,
h3,
h4,
h5,
h6 {
color: #6c71c4;
line-height: 36px;
}
h1 {
margin-bottom: 18px;
font-size: 30px;
}
h2 {
font-size: 24px;
}
h3 {
font-size: 18px;
}
h4 {
font-size: 16px;
}
h5 {
font-size: 14px;
}
h6 {
font-size: 13px;
}
hr {
margin: 0 0 19px;
border: 0;
border-bottom: 1px solid #ccc;
}
blockquote {
padding: 13px 13px 21px 15px;
margin-bottom: 18px;
font-family:georgia,serif;
font-style: italic;
}
blockquote:before {
content:"\201C";
font-size:40px;
margin-left:-10px;
font-family:georgia,serif;
color:#eee;
}
blockquote p {
font-size: 14px;
font-weight: 300;
line-height: 18px;
margin-bottom: 0;
font-style: italic;
}
code, pre {
font-family: Monaco, Andale Mono, Courier New, monospace;
}
code {
background-color: #fee9cc;
color: rgba(0, 0, 0, 0.75);
padding: 1px 3px;
border-radius: 3px;
}
em {
font-style: normal;
font-weight: bold;
color: #555;
border-radius: 3px;
background-color: #fffdf7;
}
pre {
background-color: #fffdf7;
display: block;
padding: 14px;
font-size: 12px;
margin: 0 0 10px 0;
line-height: 15px;
border: 1px solid #d9d9d9;
white-space: pre-wrap;
word-wrap: break-word;
}
pre.error {
background-color: #fff2fd;
}
pre code {
background-color: transparent;
color: #bc670f;
font-size: 12px;
}
li {
margin-bottom: 5px;
}
@media screen and (min-width: 940px) {
body {
width: 900px;
margin:10px auto;
}
}

td, th {
vertical-align: top;
padding: 2px 6px;
}
h2 {
margin-bottom: 10px;
}
table ul {
margin: 0;
padding: 0 0 0 0;
list-style-type: none;
}
.required {
background-color: #ff8000;
color: white;
}
.optional {
background-color: #5fce04;
color: white;
}
.updated {
background-color: #3c8ff3;
color: white;
}
.deprecated {
background-color: #000000;
color: white;
}

td:last-child {
max-width: 300px;
}
</style>
<title>汴地吃货 API 文档</title>
</head>

<body>
<h1>汴地吃货 API 文档</h1>

<h2>API 版本：1.9</h2>

<pre style="line-height: 20px;"><code>GET*</code>, <code>POST*</code>: need login
<code class="required">data_type</code>: required parameter
<code class="optional">data_type</code>: optional parameter
<code class="updated">x.y updated</code> or <code class="updated">x.y new</code>: updated or new API since x.y
<code class="deprecated">x.y deprecated</code>: deprecated API since x.y
</pre>

<hr />

<h2>数据类型</h2>

<ul>
<li><code>bool</code> 1</li>
<li><code>int</code> 31415926</li>
<li><code>str</code> "this is a string"</li>
<!--li><code>time</code> "2012-09-10 00:00:00"</li>
<li><code>date</code> "2012-09-10"</li-->  
</ul>

<h2>HTTP 状态码</h2>

<ul>
<li><code>200</code> 正常。</li>
<li><code>400</code> 请求格式错误。</li>
<li><code>403</code> 没有权限。（如未登录）</li>
<li><code>404</code> 请求的资源不存在。</li>
<li><code>422</code> 传递参数不正确。</li>
<li><code>501</code> 尚未实现此功能。</li>
<li><code>503</code> 暂时无法提供服务。</li>
<!--li><code>418</code> 我是一只咖啡壶☆</li-->  
</ul>

<h2>Error Code</h2>

<p>若返回的字典含有 <code>error_code</code>，客户端要处理错误，且不应将 <code>error_code</code> 本身暴露给用户。</p>
<p>若同时含有 <code>error</code>，要将 <code>error</code> 的内容显示给用户。</p>
<p>如遇 <code>NotLoggedIn</code>，应将用户跳转至登录界面。</p>

<hr />

<h2>/users</h2>

<table>

<thead>
<tr>
<th align="left">Address</th>
<th align="left">Method</th>
<th align="left">Parameter</th>
<th align="left">Return</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody> 

<tr>
<td align="left">.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left"><pre>
[
    {
        "id": 6,
        "name": "username1"
    },
    {
        "id": 7,
        "name": "username2"
    },
    {
        "id": 8,
        "name": "username3"
    },
    {
        "id": 9,
        "name": "username4"
    }
]
</pre></td>
<td align="left">返回用户列表。</td>
</tr>

<tr>
<td align="left">/:id.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left"><pre>
{
    "id": 6,
    "name": "username1"
}
</pre></td>
<td align="left">返回用户信息。</td>
</tr>

<tr>
<td align="left">/signup.json/</td>
<td align="left"><code>POST</code></td>
<td align="left">
<ul>
<li><code class="required">string</code> name</li>
<li><code class="required">string</code> password</li>
</ul>
</td>
<td align="left">
<pre>
{
    "id": 9,
    "name": "username4"
}
</pre>
<pre title="404" class="error">
{
    "name": [
        "has already been taken"
    ],
    "password": [
        "Missing password"
    ]
}
</pre>
</td>
<td align="left">注册用户</td>
</tr>

<tr>
<td align="left">/login.json/</td>
<td align="left"><code>POST</code></td>
<td align="left">
<ul>
<li><code class="required">string</code> name</li>
<li><code class="required">string</code> password</li>
</ul>
</td>
<td align="left">
<pre>
{
    "id": 12,
    "name": "username7"
}
</pre>
<pre title="404" class="error">
{
    "error": "Invalid user/password combination"
}
</pre>
</td>
<td align="left">登录用户</td>
</tr>

<tr>
<td align="left"><code class="deprecated">1.0 deprecated</code><br />/logout.json/</td>
<td align="left"><code>DELETE</code></td>
<td align="left">none</td>
<td align="left">
<ul>
  <li><code>STATUS 204</code> No Content</li>
</ul>
<pre title="404" class="error">
{
    "error": "NotLoggedIn"
}
</pre>
</td>
<td align="left">登出用户</td>
</tr>

</tbody>
</table>

<hr />

<h2>/restaurants</h2>

<table>

<thead>
<tr>
<th align="left">Address</th>
<th align="left">Method</th>
<th align="left">Parameter</th>
<th align="left">Return</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody> 

<tr>
<td align="left"><code class="updated">1.8 updated</code><br />.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left"><pre>
[
    {
        "average_cost": 5.5,
        "evaluation": "3.0",
        "id": 1,
        "image_url": "http://i2.sinaimg.cn/edu/2009/0417/2009417195017.jpg",
        "name": "农园",
        "busy": 0,
        <span class="updated">partial_recommendations"</span>: [
            {
                "id": 2,
                "name": "咖喱牛肉铁板饭",
                "recommendation_count": 27
            },
            {
                "id": 1,
                "name": "粽子",
                "recommendation_count": 18
            },
            {
                "id": 5,
                "name": "黑椒牛柳",
                "recommendation_count": 10
            }
        ]
    },
    {
        "average_cost": 6,
        "evaluation": "5",
        "id": 2,
        "image_url": "404.jpg",
        "name": "康博斯",
        "busy": 0,
        <span class="updated">"partial_recommendations"</span>: [
            {
                "id": 4,
                "name": "鱼香肉丝饭",
                "recommendation_count": 3
            }
        ]
    }
]
</pre>
</td>
<td align="left">返回支持的食堂列表。 <code>busy</code> 有三种：0="拥挤"、1="还好"、2="宽松"。 <code>status_busy</code> <code>status_normal</code> <code>status_loose</code> 表示三种状态分别的计数。<span class="updated"> <code>partial_recommendations</code> 返回推荐最多的3道推荐菜。</span></td>
</tr>

<tr>
<td align="left"><code class="updated">1.8 updated</code><br />/:id.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left">
<pre>
{
    "average_cost": 5.5,
    "category": "大众",
    "description": "农园这个地方真不错，到处的饭菜都是自己选的",
    "evaluation": "3.0",
    "id": 1,
    "image_url": "http://i2.sinaimg.cn/edu/2009/0417/2009417195017.jpg",
    "info_summary": "离教学楼最近的地方",
    "info_tel": "62750000",
    "info_time": "11:30-13:00 17:00-19:00",
    "location_latitude": 40,
    "location_longitude": 120,
    "location_name": "二教西侧",
    "location_zone": "近教学楼",
    "name": "农园",
    "status_busy": 3,
    "status_loose": 1,
    "status_normal": 0,
    "partial_dishes": [
        {
            "id": 8,
            "name": "麻辣香锅"
        },
        {
            "id": 9,
            "name": "小龙虾"
        },
        {
            "id": 10,
            "name": "鱼香肉丝"
        }
    ],
    "partial_comments": [
        {
            "id": 69,
            "user_name": "zongzi",
            "evaluation": 4,
            "content": "看看能不能推荐"
        },
        {
            "id": 70,
            "user_name": "jim",
            "evaluation": 5,
            "content": "!!!太棒了"
        }
    ],
    "busy": 0,
    <span class="updated">"partial_recommendations"</span>: [
        {
            "id": 2,
            "name": "咖喱牛肉铁板饭",
            "recommendation_count": 27
        },
        {
            "id": 1,
            "name": "粽子",
            "recommendation_count": 18
        },
        {
            "id": 5,
            "name": "黑椒牛柳",
            "recommendation_count": 10
        }
    ]
}
</pre>
<pre title="404" class="error">{"error": "RestaurantNotFound"}</pre>
</td>
<td align="left">返回 <code>id</code> 食堂的详细信息。 <code>busy</code> 有三种：0="拥挤"、1="还好"、2="宽松"。 <code>status_busy</code> <code>status_normal</code> <code>status_loose</code> 表示三种状态分别的计数。<span class="updated"> <code>partial_recommendations</code> 返回推荐最多的3道推荐菜。</span> <code>partial_dishes</code> 返回最后3道菜。 <code>partial_comments</code> 返回最后2条评论。</td>
</tr>

<tr>
<td align="left">/:id/busy.json/</td>
<td align="left"><code>PUT</code></td>
<td align="left">
<ul>
<li><code class="required">int</code> busy</li>
</ul>
</td>
<td align="left">
<ul>
  <li><code>STATUS 204</code> No Content</li>
</ul>
<pre title="404" class="error">{"error": "RestaurantNotFound"}</pre>
</td>
<td align="left">将食堂的繁忙程度更新上去。 <code>busy</code> 有三种：0="拥挤"、1="还好"、2="宽松"。</td>
</tr>

<tr>
<td align="left"><code class="updated">1.8 new</code><br />/:id/recommendations.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left">
<pre>
[
    {
        "category": "饭",
        "cost": 6,
        "description": "顾名思义就是咖喱牛肉放在铁板上",
        "evaluation": 8,
        "id": 2,
        "image_url": "http://i2.dpfile.com/2011-07-08/8599217_b.jpg",
        "name": "咖喱牛肉铁板饭",
        "recommendation_count": 27,
        "restaurant_id": 1
    },
    {
        "category": "好吃的",
        "cost": 5,
        "description": "太好吃了",
        "evaluation": 10,
        "id": 1,
        "image_url": "http://sms.jmcatv.com.cn/09duanwu/images/2008528104427759.jpg",
        "name": "粽子",
        "recommendation_count": 18,
        "restaurant_id": 1
    }
]
</pre>
<pre title="404" class="error">{"error": "RestaurantNotFound"}</pre>
</td>
<td align="left">返回 <code>id</code> 食堂的推荐菜肴列表。</td>
</tr>

</tbody>
</table>

<hr />

<h2>/restaurants/:restaurant_id/dishes</h2>

<table>

<thead>
<tr>
<th align="left">Address</th>
<th align="left">Method</th>
<th align="left">Parameter</th>
<th align="left">Return</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody> 

<tr>
<td align="left">.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left">
<pre>
[
    {
        "category": "好吃的",
        "cost": 5,
        "description": "太好吃了",
        "evaluation": 10,
        "id": 1,
        "image_url": "http://sms.jmcatv.com.cn/09duanwu/images/2008528104427759.jpg",
        "name": "粽子",
        "recommendation_count": 1,
        "restaurant_id": 1
    },
    {
        "category": "饭",
        "cost": 6,
        "description": "顾名思义就是咖喱牛肉放在铁板上",
        "evaluation": 8,
        "id": 2,
        "image_url": "http://i2.dpfile.com/2011-07-08/8599217_b.jpg",
        "name": "咖喱牛肉铁板饭",
        "recommendation_count": 1,
        "restaurant_id": 1
    }
]
</pre>
<pre title="404" class="error">{"error": "RestaurantNotFound"}</pre>
</td>
<td align="left">返回 <code>restaurant_id</code> 食堂支持的菜肴列表。</td>
</tr>

<tr>
<td align="left">/:id.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left">
<pre>
{
    "category": "好吃的",
    "cost": 5,
    "description": "太好吃了",
    "evaluation": 10,
    "id": 1,
    "image_url": "http://sms.jmcatv.com.cn/09duanwu/images/2008528104427759.jpg",
    "name": "粽子",
    "recommendation_count": 1,
    "restaurant_id": 1
}
</pre>
<pre title="404" class="error">{"error": "DishNotFound"}</pre>
</td>
<td align="left">返回 <code>restaurant_id</code> 食堂 <code>id</code> 菜肴的详细信息。</td>
</tr>

</tbody>
</table>

<hr />

<h2>/restaurants/:restaurant_id/comments</h2>

<table>

<thead>
<tr>
<th align="left">Address</th>
<th align="left">Method</th>
<th align="left">Parameter</th>
<th align="left">Return</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody>

<tr>
<td align="left">.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">
<ul>
<li><code class="optional">int</code> start</li>
</ul>
</td>
<td align="left"><pre>
[
    {
        "content": "看看能不能推荐",
        "cost": 5,
        "created_at": "2012-12-29T15:16:04Z",
        "evaluation": 4,
        "id": 26,
        "recommendation_dishes": "粽子,咖喱牛肉铁板饭,宫保鸡丁,鱼香肉丝",
        "restaurant_id": 2,
        "updated_at": "2012-12-29T15:16:04Z",
        "user_id": 2,
        "user_name": "zongzi"
    },
    {
        "content": "看看能不能推荐",
        "cost": 5,
        "created_at": "2012-12-29T15:21:15Z",
        "evaluation": 4,
        "id": 27,
        "recommendation_dishes": "鱼香肉丝饭,宫保鸡丁",
        "restaurant_id": 2,
        "updated_at": "2012-12-29T15:21:15Z",
        "user_id": 2,
        "user_name": "zongzi"
    }
]
</pre>
<pre title="404" class="error">{"error": "RestaurantNotFound"}</pre>
</td>
<td align="left">返回 <code>restaurant_id</code> 食堂最近 10 条评论，从第 <code>start</code> 条开始（默认为 0）。<br />若客户端在同一页面加载更多评论，须注意新的评论导致的重复。</td>
</tr>

<tr>
<td align="left">/:id.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left">
<pre>
{
    "content": "看看能不能推荐",
    "cost": 5,
    "created_at": "2012-12-29T15:16:04Z",
    "evaluation": 4,
    "id": 26,
    "recommendation_dishes": "粽子,咖喱牛肉铁板饭,宫保鸡丁,鱼香肉丝",
    "restaurant_id": 2,
    "updated_at": "2012-12-29T15:16:04Z",
    "user_id": 2,
    "user_name": "zongzi"
}
</pre>
<pre title="404" class="error">{"error": "CommentNotFound"}</pre>
</td>
<td align="left">返回 <code>restaurant_id</code> 食堂 <code>id</code> 评论的详细信息。</td>
</tr>

<tr>
<td align="left"><code class="updated">1.9 updated</code><br />/upload.json/</td>
<td align="left"><code>POST*</code></td>
<td align="left">
<ul>
<li><code class="required">string</code> content</li>
<li><code class="required">float</code> cost</li>
<li><code class="required">float</code> evaluation</li>
<li><code class="required">int</code> user_id</li>
<li><code class="required">string</code> recommendation_dishes</li>
<li><code class="deprecated">deprecated</code> other_dishes</li>
<li><code class="optional">string</code> seperator</li>
</ul>
</td>
<td align="left">
<pre>
{
    "content": "看看能不能推荐",
    "cost": 5,
    "created_at": "2012-12-29T15:33:55Z",
    "evaluation": 4,
    "id": 29,
    "recommendation_dishes": "粽子 咖喱牛肉铁板饭 宫保鸡丁",
    "restaurant_id": 1,
    "updated_at": "2012-12-29T15:33:55Z",
    "user_id": 2
}
</pre>
<pre title="404" class="error">
{
    "user_id": [
        "can't be blank",
        "with id= is not defined"
    ]
}
</pre>
</td>
<td align="left">给 <code>restaurant_id</code> 食堂 <code>id</code> 提交评论。<span class="updated"> <code>recommendation_dishes</code> 参数形如 <code>'已有菜肴￥新加菜肴一￥新家菜肴二' ('￥'表示分隔符)</code> ，描述推荐菜的名字列表。 <code>seperator</code> 描述recommendation_dishes中的分隔符，默认为空格' '。</span></td>
</tr>

</tbody>
</table>

<hr />

<h2>/restaurants/:restaurant_id/complaints</h2>

<table>

<thead>
<tr>
<th align="left">Address</th>
<th align="left">Method</th>
<th align="left">Parameter</th>
<th align="left">Return</th>
<th align="left">Description</th>
</tr>
</thead>

<tbody> 

<tr>
<td align="left">.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">
<ul>
<li><code class="optional">int</code> start</li>
</ul>
</td>
<td align="left"><pre>
[
    {
        "content": "太差啦",
        "created_at": "2012-12-28T17:03:59Z",
        "id": 1,
        "restaurant_id": 2,
        "updated_at": "2012-12-28T17:03:59Z",
        "user_id": 3,
        "user_name": "jim"
    },
    {
        "content": "试试投诉",
        "created_at": "2012-12-28T17:08:50Z",
        "id": 2,
        "restaurant_id": 2,
        "updated_at": "2012-12-28T17:08:50Z",
        "user_id": 5,
        "user_name": "hello"
    }
]
</pre>
<pre title="404" class="error">{"error": "RestaurantNotFound"}</pre>
</td>
<td align="left">返回 <code>restaurant_id</code> 食堂最近 10 条投诉，从第 <code>start</code> 条开始（默认为 0）。<br />若客户端在同一页面加载更多投诉，须注意新的投诉导致的重复。</td>
</tr>

<tr>
<td align="left">/:id.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left">
<pre>
{
    "content": "太差啦",
    "created_at": "2012-12-28T17:03:59Z",
    "id": 1,
    "restaurant_id": 2,
    "updated_at": "2012-12-28T17:03:59Z",
    "user_id": 3,
    "user_name": "jim"
}
</pre>
<pre title="404" class="error">{"error": "ComplaintNotFound"}</pre>
</td>
<td align="left">返回 <code>restaurant_id</code> 食堂 <code>id</code> 投诉的详细信息。</td>
</tr>

<tr>
<td align="left">/upload.json/</td>
<td align="left"><code>POST*</code></td>
<td align="left">
<ul>
<li><code class="required">string</code> content</li>
<li><code class="required">int</code> user_id</li>
</ul>
</td>
<td align="left">
<pre>
{
    "content": "试试投诉",
    "created_at": "2012-12-28T17:08:50Z",
    "id": 2,
    "restaurant_id": 2,
    "updated_at": "2012-12-28T17:08:50Z",
    "user_id": 5
}
</pre>
<pre title="404" class="error">
{
    "user_id": [
        "can't be blank",
        "with id= is not defined"
    ]
}
</pre>
</td>
<td align="left">给 <code>restaurant_id</code> 食堂 <code>id</code> 投诉。</td>
</tr>

</tbody>
</table>

<hr />

<h2>/dishes/:dish_id/comments</h2>

<table>

<thead>
<tr>
<th align="left">Address</th>
<th align="left">Method</th>
<th align="left">Parameter</th>
<th align="left">Return</th>
<th align="left">Description</th>
</tr>
</thead>

<tr>
<td align="left">.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">
<ul>
<li><code class="optional">int</code> start</li>
</ul>
</td>
<td align="left"><pre>
[
    {
        "content": "这个菜我喜欢",
        "created_at": "2012-12-26T17:18:54Z",
        "dish_id": 1,
        "evaluation": 5,
        "id": 5,
        "updated_at": "2012-12-26T17:18:54Z",
        "user_id": 1,
        "user_name": "jimdtc"
    },
    {
        "content": "这个菜我喜欢",
        "created_at": "2012-12-26T17:18:56Z",
        "dish_id": 1,
        "evaluation": 5,
        "id": 6,
        "updated_at": "2012-12-26T17:18:56Z",
        "user_id": 1,
        "user_name": "jimdtc"
    }
]
</pre>
<pre title="404" class="error">{"error": "DishNotFound"}</pre>
</td>
<td align="left">返回 <code>dish_id</code> 菜肴最近 10 条评论，从第 <code>start</code> 条开始（默认为 0）。<br />若客户端在同一页面加载更多评论，须注意新的评论导致的重复。</td>
</tr>

<tr>
<td align="left">/:id.json/</td>
<td align="left"><code>GET</code></td>
<td align="left">none</td>
<td align="left">
<pre>
{
    "content": "这个菜我喜欢",
    "created_at": "2012-12-26T17:18:54Z",
    "dish_id": 1,
    "evaluation": 5,
    "id": 5,
    "updated_at": "2012-12-26T17:18:54Z",
    "user_id": 1,
    "user_name": "jimdtc"
}
</pre>
<pre title="404" class="error">{"error": "CommentNotFound"}</pre>
</td>
<td align="left">返回 <code>dish_id</code> 菜肴 <code>id</code> 评论的详细信息。</td>
</tr>

<tr>
<td align="left">/upload.json/</td>
<td align="left"><code>POST*</code></td>
<td align="left">
<ul>
<li><code class="required">string</code> content</li>
<li><code class="required">float</code> evaluation</li>
<li><code class="required">int</code> user_id</li>
</ul>
</td>
<td align="left">
<pre>
{
    "content": "试试评论",
    "created_at": "2012-12-28T16:38:06Z",
    "dish_id": 1,
    "evaluation": 5,
    "id": 19,
    "updated_at": "2012-12-28T16:38:06Z",
    "user_id": 3
}
</pre>
<pre title="404" class="error">
{
    "user_id": [
        "can't be blank",
        "with id= is not defined"
    ]
}
</pre>
</td>
<td align="left">给 <code>dish_id</code> 菜肴 <code>id</code> 提交评论。</td>
</tr>

</tbody>
</table>

<hr />

</body>
</html>

